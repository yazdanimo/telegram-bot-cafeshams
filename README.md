# 🤖 ربات خبری کافه شمس

سیستم خبری خودکار برای جمع‌آوری و انتشار اخبار از منابع مختلف ایرانی و بین‌المللی

## ✨ ویژگی‌ها

### 📰 خبرگیری هوشمند
- جمع‌آوری از **27 منبع خبری** معتبر
- **14 منبع فارسی** + **13 منبع انگلیسی**
- **جلوگیری از تکرار** خبرها با هش‌گیری
- **خلاصه‌سازی خودکار** محتوای اخبار

### 🎨 فرمت زیبا
- **نام منبع و عنوان بولد**
- **Instant View** و **Link Preview**
- **لینک کلیک‌پذیر** مشاهده کامل
- **برندینگ کافه شمس** در انتها

### ⚡ عملکرد خودکار
- **خبرگیری هر 3 دقیقه**
- **سیستم تایید دستی** قبل از انتشار
- **دکمه "ارسال به کانال"** هوشمند
- **آمار کامل** عملکرد

## 🚀 راه‌اندازی

### Environment Variables در Railway
```bash
BOT_TOKEN=your_telegram_bot_token
EDITORS_CHAT_ID=-1002514471809
CHANNEL_ID=-1002685190359
PORT=8443
```

### مراحل Deploy
1. **Push کردن کدها به GitHub**
2. **اتصال Repository به Railway**
3. **تنظیم Environment Variables**
4. **اضافه کردن ربات به گروه/کانال**

## 📱 API Endpoints

### مدیریت اصلی
- `GET /` - وضعیت کلی ربات
- `GET /health` - بررسی سلامت سیستم
- `GET /stats` - آمار کامل عملکرد

### خبرگیری
- `GET /news` - جمع‌آوری دستی اخبار
- `GET /start-auto` - شروع خبرگیری خودکار
- `GET /stop-auto` - توقف خبرگیری خودکار

### تست و عیب‌یابی
- `GET /test` - تست اتصال ربات
- `GET /send` - تست ارسال پیام
- `GET /test-channel-access` - بررسی دسترسی کانال

### Webhook
- `POST /{BOT_TOKEN}` - دریافت callback از تلگرام

## 🏗️ ساختار پروژه

```
cafe-shams-news-bot/
├── main.py              # فایل اصلی Flask + Bot
├── requirements.txt     # وابستگی‌های Python
├── railway.json         # تنظیمات Railway
├── Procfile            # تنظیمات فرآیند
├── sources.json        # منابع خبری (اختیاری)
└── README.md           # مستندات
```

## 📰 منابع خبری

### منابع فارسی (14 منبع)
- **رسمی:** مهر، فارس، تسنیم، ایرنا، ایسنا
- **مستقل:** همشهری آنلاین، خبر آنلاین، مشرق
- **سیاسی:** انتخاب، جماران، اعتماد، اصلاحات
- **عمومی:** آخرین خبر، هم‌میهن

### منابع انگلیسی (13 منبع)
- **ایرانی:** Tehran Times, Iran Front Page
- **آمریکایی:** ABC News, CNN, AP News, The Atlantic
- **بریتانیایی:** The Guardian, BBC World
- **بین‌المللی:** Al Jazeera, Reuters
- **تحلیلی:** Foreign Affairs, Brookings, Carnegie

## 🔄 فرآیند کار

### 1. جمع‌آوری خودکار
```
هر 3 دقیقه → بررسی 27 منبع → انتخاب اولین خبر جدید
```

### 2. پردازش محتوا
```
RSS Feed → استخراج عنوان/خلاصه → فرمت‌بندی زیبا
```

### 3. تایید دستی
```
ارسال به گروه ادیتورها → دکمه "ارسال به کانال" → تایید انسانی
```

### 4. انتشار نهایی
```
کلیک دکمه → ارسال به کانال → تغییر وضعیت دکمه
```

## 🎛️ نحوه استفاده

### شروع خبرگیری خودکار
```bash
curl https://your-railway-app.railway.app/start-auto
```

### دریافت آمار
```bash
curl https://your-railway-app.railway.app/stats
```

### تست دسترسی کانال
```bash
curl https://your-railway-app.railway.app/test-channel-access
```

## 🔧 عیب‌یابی

### مشکلات متداول

#### "Chat not found"
**علت:** ربات در کانال admin نیست  
**حل:** اضافه کردن ربات به کانال با مجوز "Manage Messages"

#### "No new news"
**علت:** همه اخبار قبلاً ارسال شده  
**حل:** انتظار برای خبرهای جدید یا restart ربات

#### دکمه کار نمی‌کند
**علت:** webhook تنظیم نشده  
**حل:** بررسی BOT_TOKEN و تنظیمات webhook

### لاگ‌های مفید
```bash
✅ خبر ارسال شد از Mehr News: عنوان
📤 Forward to channel: Success
🔄 Auto news cycle started
```

## 📊 مثال خروجی

### خبر نهایی در کانال
```
📰 **Khabar Online**

**سازمان ملل: هیچ اطلاعیه رسمی مبنی بر فعال‌سازی مکانیسم ماشه دریافت نکرده‌ایم**

سازمان ملل تاکنون هیچ اطلاعیه رسمی از سوی طرفین برجام درباره فعال‌سازی سازوکار بازگشت خودکار تحریم‌ها علیه ایران دریافت نکرده است...

🔗 [مشاهده کامل خبر](https://example.com/news)

🆔 @cafeshamss     
کافه شمس ☕️🍪
```

### Response API
```json
{
  "status": "SUCCESS",
  "source": "Khabar Online",
  "title": "سازمان ملل: هیچ اطلاعیه رسمی...",
  "message_id": 12345,
  "total_sources": 27
}
```

## 🛡️ امنیت

### تنظیمات امنیتی
- **BOT_TOKEN** محرمانه نگهداری شود
- **Chat ID** ها عمومی نشوند
- **Webhook URL** تنها برای تلگرام در دسترس باشد

### مجوزهای ربات
```
گروه ادیتورها: Send Messages, Delete Messages
کانال عمومی: Send Messages, Edit Messages
```

## 📈 بهینه‌سازی

### عملکرد
- **Connection pooling** برای درخواست‌های HTTP
- **Async processing** برای سرعت بالا
- **Error handling** قوی برای پایداری

### مصرف منابع
- **Memory usage:** ~50MB
- **CPU usage:** کم (webhook-based)
- **Network:** ~1MB در هر دور خبرگیری

## 🔮 آپدیت‌های آینده

### ویژگی‌های پیشنهادی
- [ ] **دسته‌بندی اخبار** (سیاسی، اقتصادی، ورزشی)
- [ ] **فیلتر کلمات کلیدی** برای انتخاب هوشمند
- [ ] **آمار تعامل** کاربران با اخبار
- [ ] **پشتیبانی چندزبانه** (ترجمه خودکار)
- [ ] **برنامه‌ریزی انتشار** (زمان‌بندی اخبار)

## 📞 پشتیبانی

### ارتباط
- **کانال:** @cafeshamss
- **گروه پشتیبانی:** لینک موجود در کد

### مستندات بیشتر
- **Railway Docs:** https://docs.railway.com
- **Python Telegram Bot:** https://docs.python-telegram-bot.org

---

**🏆 ساخته شده برای کافه شمس - سیستم خبری هوشمند** ☕

*آخرین بروزرسانی: ژانویه 2025*
