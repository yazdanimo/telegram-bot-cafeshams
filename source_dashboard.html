html = "<html><head><meta charset='utf-8'><title>📊 گزارش منابع</title></head><body>"
html += "<h2>📊 وضعیت منابع خبر</h2><table border='1' cellpadding='5' style='border-collapse:collapse'>"
html += "<tr><th>منبع</th><th>تعداد کل</th><th>موفق</th><th>ناموفق</th></tr>"

for name, stats in health_report.items():
    total = stats.get("total", 0)
    success = stats.get("success", 0)
    failed = stats.get("failed", 0)
    row_color = "#d4fcdc" if success > failed else "#fde4e1"
    html += f"<tr style='background:{row_color}'><td>{name}</td><td>{total}</td><td>{success}</td><td>{failed}</td></tr>"

html += "</table><br><p>تاریخ گزارش: " + datetime.datetime.now().strftime("%Y-%m-%d %H:%M") + "</p></body></html>"

try:
    with open("source_dashboard.html", "w", encoding="utf-8") as f:
        f.write(html)
except Exception as e:
    print(f"❌ خطا در ذخیره source_dashboard.html: {e}")
        html += f"<tr style='background:{color}'><td>{name}</td><td>{total}</td><td>{success}</td><td>{failed}</td></tr>"

    html += "</table><br><p>تاریخ گزارش: " + datetime.datetime.now().strftime("%Y-%m-%d %H:%M") + "</p></body></html>"

    try:
        with open("source_dashboard.html", "w", encoding="utf-8") as f:
            f.write(html)
    except Exception as e:
        print(f"❌ خطا در ذخیره source_dashboard.html: {e}")
